!function(t,e,n){"use strict";e.module("vzx.sync",[]).constant("aprConfig",{stopOn:null,resetOn:null,autosolve:!1,neverOverwrite:!1,handleVisibilityChange:!1}).run(["$rootScope","$document","sync","aprConfig",function(t,e,n,i){function r(t){return t&&("$stateChangeStart"===t||"$routeChangeStart"===t||"$stateChangeSuccess"===t||"$routeChangeSuccess"===t)}function s(){e[0].hidden?n.delayAll():n.resetDelay()}r(i.stopOn)&&t.$on(i.stopOn,function(){n.stopAll()}),r(i.resetOn)&&t.$on(i.resetOn,function(){n.reset()}),i.handleVisibilityChange&&(s(),e.on("visibilitychange",s))}]).factory("sync",["$interval","$q","$http","aprConfig",function(t,i,r,s){function o(t,e){this.target=t,this.set(e)}function a(t){var n=null;return s.neverOverwrite||e.forEach(l,function(i){e.equals(i.target,t)&&(n=i)}),n}var l=[],c={action:"get",argumentsArray:[],delay:5e3,idleDelay:1e4,autosolve:s.autosolve,catchError:!1};return o.prototype.set=function(t){var n=["action","argumentsArray","delay","idleDelay","autosolve","catchError"];e.forEach(n,function(e){t&&t[e]?this[e]=t[e]:this[e]||(this[e]=c[e])},this),this.normalDelay=this.delay},o.prototype.start=function(){function n(){(!f||e.isUndefined(s)||s.$resolved)&&(o=new Date,s=a[l].apply(a,c),s.$resolved=!1,(s.$promise||s).then(function(t){s.$resolved=!0,(e.isUndefined(p.stopTimestamp)||o>=p.stopTimestamp)&&p.deferred.notify(t)},function(t){s.$resolved=!0,h&&(e.isUndefined(p.stopTimestamp)||o>=p.stopTimestamp)&&p.deferred.notify(t)}))}var s,o,a=this.target,l=this.action,c=this.argumentsArray.slice(0),u=this.delay,f=this.autosolve,h=this.catchError,p=this;this.deferred=this.deferred||i.defer(),"string"==typeof a&&(c.unshift(a),a=r),n(),this.interval=t(n,u),this.promise=this.deferred.promise},o.prototype.stop=function(){e.isDefined(this.interval)&&(t.cancel(this.interval),this.interval=n,this.stopTimestamp=new Date)},o.prototype.remove=function(){var t=l.indexOf(this);this.stop(),l.splice(t,1)},o.prototype.restart=function(){this.stop(),this.start()},{get:function(t,e){var n=a(t);return n?(n.set(e),n.restart()):(n=new o(t,e),l.push(n),n.start()),n},size:function(){return l.length},stopAll:function(){e.forEach(l,function(t){t.stop()})},restartAll:function(){e.forEach(l,function(t){t.restart()})},reset:function(){this.stopAll(),l=[]},delayAll:function(){e.forEach(l,function(t){t.delay=t.idleDelay,t.restart()})},resetDelay:function(){e.forEach(l,function(t){t.delay=t.normalDelay,t.restart()})}}}])}(window,window.angular);